angular.module("ngCacheBuster",[]).config(["$httpProvider",function($httpProvider){return $httpProvider.interceptors.push("httpRequestInterceptorCacheBuster")}]).provider("httpRequestInterceptorCacheBuster",function(){this.matchlist=[/.*partials.*/,/.*views.*/],this.logRequests=!1,this.black=!1,this.setMatchlist=function(list,black){this.black="undefined"!=typeof black&&black,this.matchlist=list},this.setLogRequests=function(logRequests){this.logRequests=logRequests},this.$get=["$q","$log",function($q,$log){var matchlist=this.matchlist,logRequests=this.logRequests,black=this.black;return logRequests&&$log.log("Blacklist? ",black),{request:function(config){for(var busted=!black,i=0;i<matchlist.length;i++)if(config.url.match(matchlist[i])){busted=black;break}if(busted){var d=new Date;config.url=config.url.replace(/[?|&]cacheBuster=\d+/,""),config.url+=config.url.indexOf("?")===-1?"?":"&",config.url+="cacheBuster="+d.getTime()}if(logRequests){var log="request.url ="+config.url;busted?$log.warn(log):$log.info(log)}return config||$q.when(config)}}}]});var app=angular.module("DrizlyApp",["ui.sortable","ngRoute","ngCacheBuster"]);app.constant("URL","data/"),app.filter("render",function(){return function(value){return value}}),app.filter("trustAsHtml",function($sce){return function(value){return $sce.trustAsHtml(value)}}),app.config(function(httpRequestInterceptorCacheBusterProvider){httpRequestInterceptorCacheBusterProvider.setMatchlist([/.*css.*/,/.*scripts.*/,/.*data.*/],!0)}),app.config(function($sceDelegateProvider){$sceDelegateProvider.resourceUrlWhitelist(["self","**"])}),app.config(function($routeProvider,$locationProvider){$routeProvider.when("/",{controller:"templateController",templateUrl:"partials/view1.html"}).otherwise({redirectTo:"/"}),$locationProvider.html5Mode(!0)}),app.service("Project",function(){this.current=0}),app.factory("DataService",function($http,URL){var getData=function(){return $http.get(URL+"emails.json")},saveData=function(data){$http.post("scripts/saveJSON.php",data).success(function(){alert("Success, List Saved")}).error(function(err){alert("Failed: "+err)})};return{getData:getData,saveData:saveData}}),app.factory("TemplateService",function($http,URL){var getTemplates=function(){return $http.get(URL+"templates.json")};return{getTemplates:getTemplates}}),app.controller("templateController",function(DataService,TemplateService,$sce,Project){var ctrl=this;ctrl.content=[],ctrl.fetchContent=function(){DataService.getData().then(function(result){ctrl.content=result.data})},ctrl.fetchTemplates=function(){TemplateService.getTemplates().then(function(result){ctrl.tpl=result.data})},ctrl.currentProject=Project.current,ctrl.fetchContent(),ctrl.fetchTemplates(),ctrl.loadProject=function(project){var index=ctrl.content.indexOf(project);Project.current=index,ctrl.currentProject=index,$(".main").toggleClass("hide-projects")},ctrl.openProjects=function(){$(".main").toggleClass("hide-projects")},ctrl.addProject=function(newProject){ctrl.content.push({name:newProject.name,subject:newProject.subject,locked:0,blocks:[]})},ctrl.saveContent=function(){DataService.saveData(ctrl.content)},ctrl.removeProject=function(project){var index=ctrl.content.indexOf(project);0==project.locked?confirm("Are you sure you want to delete this project?")&&ctrl.content.splice(index,1):alert("Cannot delete project")},ctrl.copyContent=function(project){if(confirm("Are you sure you want to copy this project?")){var index=ctrl.content.indexOf(project),duplicate=angular.copy(ctrl.content[index]),newProject={};newProject.name=duplicate.name+" Copy",newProject.locked=0,newProject.subject=duplicate.subject,newProject.tracking=duplicate.tracking,newProject.blocks=duplicate.blocks,ctrl.content.push(newProject)}},ctrl.export=function(){ctrl.html=ctrl.tpl.htmlTop,$(".block-list .block").each(function(index){ctrl.html+=$(this).html()}),ctrl.html+=ctrl.tpl.htmlBottom,$(".exportContents textarea").val(ctrl.html),$(".exportContents").dialog({buttons:{OK:function(){$(this).dialog("close")}},title:"Email HTML",width:600,height:400,position:{my:"center center",at:"center center"}})},ctrl.addTemplate=function(template){var blockcount=ctrl.content[Project.current].blocks.length;ctrl.content[Project.current].blocks.push({block_id:blockcount+1,block_type:template})}}),app.directive("block",function($compile,TemplateService){var getTemplate=function(templates,contentType){var template={};switch(contentType){case"header":template=templates.header;break;case"featureImage":template=templates.featureImage;break;case"featureMessage":template=templates.featureMessage;break;case"gridThree":template=templates.gridThree;break;case"productTwo":template=templates.productTwo;break;case"productThree":template=templates.productThree;break;case"imageText":template=templates.imageText;break;case"textImage":template=templates.textImage;break;case"imageTextRed":template=templates.imageTextRed;break;case"textImageRed":template=templates.textImageRed;break;case"imageTextGrey":template=templates.imageTextGrey;break;case"textImageGrey":template=templates.textImageGrey;break;case"splitImage":template=templates.splitImage;break;case"spacer":template=templates.spacer;break;case"footer":template=templates.footer}return template},linker=function(scope,element,attrs){TemplateService.getTemplates().then(function(response){var templates=response.data;element.html(getTemplate(templates,scope.content.block_type)),$(element).append('<div class="block-toggle"><a data-ng-click="onRemove()" class="btn-trash-block icon-close"></a></div>'),$compile(element.contents())(scope)})};return{restrict:"EA",replace:!0,template:"<li></li>",link:linker,scope:{content:"=",onRemove:"&"}}}),app.directive("edit",function($compile,TemplateService){var getTemplate=function(templates,contentType){var template="";switch(contentType){case"header":template='<a class="toggle" data-ng-click="open($event)">Header</a><div class="accordion-body"><label>Tracking Code<br><input type="text" data-ng-model="content.tracking" /></label><br><label>Button URL (Do Not Include Tracking)<br><input type="text" data-ng-model="content.btnurl" /></label><br><label>Button Text<br><input type="text" data-ng-model="content.btntext" /></div>';break;case"featureImage":template='<a class="toggle" data-ng-click="open($event)">Feature Image</a><div class="accordion-body"><label>Image - 580x250<br><input type="text" data-ng-model="content.image" /></label><br><label>URL<br> <input type="text" data-ng-model="content.link" /></label><br><label>Alt Text<br> <input type="text" data-ng-model="content.alt" /></label></div>';break;case"featureMessage":template='<a class="toggle" data-ng-click="open($event)">Feature Message</a><div class="accordion-body"><label>Headline<br><input type="text" data-ng-model="content.headline" /></label><br><label>Message<br> <textarea rows="8" type="text" data-ng-model="content.text" /></textarea></label></div>';break;case"gridThree":template='<a class="toggle" data-ng-click="open($event)">Grid Three</a><div class="accordion-body"> <a class="toggle" data-ng-click="open($event)">Image 1</a> <div class="accordion-body one"> <label>Image 1 - 272x376 <br> <input data-ng-model="content.image1" type="text" /> </label> <br> <label>URL 1 <br> <input data-ng-model="content.link1" type="text" /> </label> <br> </div> <a class="toggle" data-ng-click="open($event)">Image 2</a> <div class="accordion-body two"> <label>Image 2 - 272x178 <br> <input data-ng-model="content.image2" type="text" /> </label> <br> <label>URL 2 <br> <input data-ng-model="content.link2" type="text" /> </label> <br> </div> <a class="toggle" data-ng-click="open($event)">Image 3</a> <div class="accordion-body three"> <label>Image 3 - 272x178 <br> <input data-ng-model="content.image3" type="text" /> </label> <br> <label>URL 3 <br> <input data-ng-model="content.link3" type="text" /> </label> <br> </div></div>';break;case"productTwo":template='<a class="toggle" data-ng-click="open($event)">Product Two</a><div class="accordion-body"> <a class="toggle" data-ng-click="open($event)">Product 1</a> <div class="accordion-body one"> <label>Image 1 - 150x225 <br> <input data-ng-model="content.image1" type="text" /> </label> <br> <label>URL 1 <br> <input data-ng-model="content.link1" type="text" /> </label> <br> <label>Line 1 <br> <input data-ng-model="content.texttop1" type="text" /> </label> <br> <label>Line 2 <br> <input data-ng-model="content.textbottom1" type="text" /> </label> <br> <label>Price <br> <input data-ng-model="content.price1" type="text" /> </label> <br> <label>Button Text <br> <input data-ng-model="content.buttontext1" type="text" /> </label> <br> </div> <a class="toggle" data-ng-click="open($event)">Product 2</a> <div class="accordion-body two"> <label>Image 2 - 150x225 <br> <input data-ng-model="content.image2" type="text" /> </label> <br> <label>URL 2 <br> <input data-ng-model="content.link2" type="text" /> </label> <br> <label>Line 1 <br> <input data-ng-model="content.texttop2" type="text" /> </label> <br> <label>Line 2 <br> <input data-ng-model="content.textbottom2" type="text" /> </label> <br> <label>Price <br> <input data-ng-model="content.price2" type="text" /> </label> <br> <label>Button Text <br> <input data-ng-model="content.buttontext2" type="text" /> </label> <br> </div></div>';break;case"productThree":template='<a class="toggle" data-ng-click="open($event)">Product Three</a><div class="accordion-body"><a class="toggle" data-ng-click="open($event)">Product 1</a><div class="accordion-body one"><label>Image 1 - 150x225<br> <input data-ng-model="content.image1" type="text" /></label><br><label>URL 1<br> <input data-ng-model="content.link1" type="text" /></label><br><label>Line 1<br> <input data-ng-model="content.texttop1" type="text" /></label><br><label>Line 2<br> <input data-ng-model="content.textbottom1" type="text" /></label><br><label>Price<br> <input data-ng-model="content.price1" type="text" /></label><br><label>Button Text<br> <input data-ng-model="content.buttontext1" type="text" /></label><br></div><a class="toggle" data-ng-click="open($event)">Product 2</a><div class="accordion-body two"><label>Image 2 - 150x225<br> <input data-ng-model="content.image2" type="text" /></label><br><label>URL 2<br> <input data-ng-model="content.link2" type="text" /></label><br><label>Line 1<br> <input data-ng-model="content.texttop2" type="text" /></label><br><label>Line 2<br> <input data-ng-model="content.textbottom2" type="text" /></label><br><label>Price<br> <input data-ng-model="content.price2" type="text" /></label><br><label>Button Text<br> <input data-ng-model="content.buttontext2" type="text" /></label><br></div><a class="toggle" data-ng-click="open($event)">Product 3</a><div class="accordion-body three"><label>Image 3 - 150x225<br> <input data-ng-model="content.image3" type="text" /></label><br><label>URL 3<br> <input data-ng-model="content.link3" type="text" /></label><br><label>Line 1<br> <input data-ng-model="content.texttop3" type="text" /></label><br><label>Line 2<br> <input data-ng-model="content.textbottom3" type="text" /></label><br><label>Price<br> <input data-ng-model="content.price3" type="text" /></label><br><label>Button Text<br> <input data-ng-model="content.buttontext3" type="text" /></label><br></div></div>';break;case"imageText":template='<a class="toggle" data-ng-click="open($event)">Image Text</a><div class="accordion-body"><label>Image - 116x116<br><input type="text" data-ng-model="content.image" /></label><br><label>URL<br> <input type="text" data-ng-model="content.link" /><br><label>Headline<br> <input type="text" data-ng-model="content.headline" /></label><br><label>Message<br> <input type="text" data-ng-model="content.text" /></label></div>';break;case"textImage":template='<a class="toggle" data-ng-click="open($event)">Text Image</a><div class="accordion-body">Headline<br> <input type="text" data-ng-model="content.headline" /></label><br><label>Message<br> <input type="text" data-ng-model="content.text" /></label><br><label>Image - 472x396<br><input type="text" data-ng-model="content.image" /></label><br><label>URL<br> <input type="text" data-ng-model="content.link" /><label></div>';break;case"imageTextRed":template='<a class="toggle" data-ng-click="open($event)">Image Text "Red"</a><div class="accordion-body"><label>Image- 472x396<br><input type="text" data-ng-model="content.image" /></label><br><label>URL<br> <input type="text" data-ng-model="content.link" /><br><label>Headline<br> <input type="text" data-ng-model="content.headline" /></label><br><label>Message<br> <input type="text" data-ng-model="content.text" /></label></div>';break;case"textImageRed":template='<a class="toggle" data-ng-click="open($event)">Text Image "Red"</a><div class="accordion-body"><label>Image- 472x396<br><input type="text" data-ng-model="content.image" /></label><br><label>URL<br> <input type="text" data-ng-model="content.link" /><br><label>Headline<br> <input type="text" data-ng-model="content.headline" /></label><br><label>Message<br> <input type="text" data-ng-model="content.text" /></label></div>';break;case"imageTextGrey":template='<a class="toggle" data-ng-click="open($event)">Image Text "Grey"</a><div class="accordion-body"><label>Image- 472x396<br><input type="text" data-ng-model="content.image" /></label><br><label>URL<br> <input type="text" data-ng-model="content.link" /><br><label>Headline<br> <input type="text" data-ng-model="content.headline" /></label><br><label>Message<br> <input type="text" data-ng-model="content.text" /></label></div>';break;case"textImageGrey":template='<a class="toggle" data-ng-click="open($event)">Text Image "Grey"</a><div class="accordion-body"><label>Image- 472x396<br><input type="text" data-ng-model="content.image" /></label><br><label>URL<br> <input type="text" data-ng-model="content.link" /><br><label>Headline<br> <input type="text" data-ng-model="content.headline" /></label><br><label>Message<br> <input type="text" data-ng-model="content.text" /></label></div>';break;case"splitImage":template='<a class="toggle" data-ng-click="open($event)">Split Image</a><div class="accordion-body"> <a class="toggle" data-ng-click="open($event)">Image 1</a><div class="accordion-body"> <label>Left Image - 472x314 <br> <input type="text" data-ng-model="content.image1" /> <label>Left URL <br> <input type="text" data-ng-model="content.link1" /></div><a class="toggle" data-ng-click="open($event)">Image 2</a><div class="accordion-body"> <label>Right Image - 472x314 <br> <input type="text" data-ng-model="content.image2" /> <label>Right URL <br> <input type="text" data-ng-model="content.link2" /></div></div>';break;case"spacer":template='<a class="toggle" data-ng-click="open($event)">Horz. Spacer</a><div class="accordion-body"><label>Spacer Height (use px)<br><input type="text" data-ng-model="content.height" /></div>';break;case"footer":template='<a class="toggle" data-ng-click="open($event)">Footer</a><div class="accordion-body"><label>Tracking Code<br><input type="text" data-ng-model="content.tracking" /></div>'}return template},linker=function(scope,element,attrs){TemplateService.getTemplates().then(function(response){var templates=response.data;element.html(getTemplate(templates,scope.content.block_type)),$compile(element.contents())(scope)}),scope.open=function($event){function hasClass(element,cls){return(" "+element.className+" ").indexOf(" "+cls+" ")>-1}var $this=$event.currentTarget,sibling=$this.nextSibling;hasClass(sibling,"show")?sibling.className=sibling.className.replace(/(?:^|\s)show(?!\S)/g,""):sibling.className+=" show"}};return{restrict:"EA",replace:!0,link:linker,template:"<li></li>",scope:{content:"="}}}),angular.module("ui.sortable",[]).value("uiSortableConfig",{}).directive("uiSortable",["uiSortableConfig","$timeout","$log",function(uiSortableConfig,$timeout,$log){return{require:"?ngModel",scope:{ngModel:"=",uiSortable:"="},link:function(scope,element,attrs,ngModel){function combineCallbacks(first,second){return second&&"function"==typeof second?function(){first.apply(this,arguments),second.apply(this,arguments)}:first}function getSortableWidgetInstance(element){var data=element.data("ui-sortable");return data&&"object"==typeof data&&"ui-sortable"===data.widgetFullName?data:null}function hasSortingHelper(element,ui){var helperOption=element.sortable("option","helper");return"clone"===helperOption||"function"==typeof helperOption&&ui.item.sortable.isCustomHelperUsed()}function isFloating(item){return/left|right/.test(item.css("float"))||/inline|table-cell/.test(item.css("display"))}function getElementScope(elementScopes,element){for(var result=null,i=0;i<elementScopes.length;i++){var x=elementScopes[i];if(x.element[0]===element[0]){result=x.scope;break}}return result}function afterStop(e,ui){ui.item.sortable._destroy()}var savedNodes,opts={},directiveOpts={"ui-floating":void 0},callbacks={receive:null,remove:null,start:null,stop:null,update:null},wrappers={helper:null};return angular.extend(opts,directiveOpts,uiSortableConfig,scope.uiSortable),angular.element.fn&&angular.element.fn.jquery?(ngModel?(scope.$watch("ngModel.length",function(){$timeout(function(){getSortableWidgetInstance(element)&&element.sortable("refresh")},0,!1)}),callbacks.start=function(e,ui){if("auto"===opts["ui-floating"]){var siblings=ui.item.siblings(),sortableWidgetInstance=getSortableWidgetInstance(angular.element(e.target));sortableWidgetInstance.floating=isFloating(siblings)}ui.item.sortable={model:ngModel.$modelValue[ui.item.index()],index:ui.item.index(),source:ui.item.parent(),sourceModel:ngModel.$modelValue,cancel:function(){ui.item.sortable._isCanceled=!0},isCanceled:function(){return ui.item.sortable._isCanceled},isCustomHelperUsed:function(){return!!ui.item.sortable._isCustomHelperUsed},_isCanceled:!1,_isCustomHelperUsed:ui.item.sortable._isCustomHelperUsed,_destroy:function(){angular.forEach(ui.item.sortable,function(value,key){ui.item.sortable[key]=void 0})}}},callbacks.activate=function(e,ui){savedNodes=element.contents();var placeholder=element.sortable("option","placeholder");if(placeholder&&placeholder.element&&"function"==typeof placeholder.element){var phElement=placeholder.element();phElement=angular.element(phElement);var excludes=element.find('[class="'+phElement.attr("class")+'"]:not([ng-repeat], [data-ng-repeat])');savedNodes=savedNodes.not(excludes)}var connectedSortables=ui.item.sortable._connectedSortables||[];connectedSortables.push({element:element,scope:scope}),ui.item.sortable._connectedSortables=connectedSortables},callbacks.update=function(e,ui){if(!ui.item.sortable.received){ui.item.sortable.dropindex=ui.item.index();var droptarget=ui.item.parent();ui.item.sortable.droptarget=droptarget;var droptargetScope=getElementScope(ui.item.sortable._connectedSortables,droptarget);ui.item.sortable.droptargetModel=droptargetScope.ngModel,element.sortable("cancel")}hasSortingHelper(element,ui)&&!ui.item.sortable.received&&"parent"===element.sortable("option","appendTo")&&(savedNodes=savedNodes.not(savedNodes.last())),savedNodes.appendTo(element),ui.item.sortable.received&&(savedNodes=null),ui.item.sortable.received&&!ui.item.sortable.isCanceled()&&scope.$apply(function(){ngModel.$modelValue.splice(ui.item.sortable.dropindex,0,ui.item.sortable.moved)})},callbacks.stop=function(e,ui){!ui.item.sortable.received&&"dropindex"in ui.item.sortable&&!ui.item.sortable.isCanceled()?scope.$apply(function(){ngModel.$modelValue.splice(ui.item.sortable.dropindex,0,ngModel.$modelValue.splice(ui.item.sortable.index,1)[0])}):"dropindex"in ui.item.sortable&&!ui.item.sortable.isCanceled()||hasSortingHelper(element,ui)||savedNodes.appendTo(element),savedNodes=null},callbacks.receive=function(e,ui){ui.item.sortable.received=!0},callbacks.remove=function(e,ui){"dropindex"in ui.item.sortable||(element.sortable("cancel"),ui.item.sortable.cancel()),ui.item.sortable.isCanceled()||scope.$apply(function(){ui.item.sortable.moved=ngModel.$modelValue.splice(ui.item.sortable.index,1)[0]})},wrappers.helper=function(inner){return inner&&"function"==typeof inner?function(e,item){var innerResult=inner.apply(this,arguments);return item.sortable._isCustomHelperUsed=item!==innerResult,innerResult}:inner},scope.$watch("uiSortable",function(newVal){var sortableWidgetInstance=getSortableWidgetInstance(element);sortableWidgetInstance&&angular.forEach(newVal,function(value,key){return key in directiveOpts?("ui-floating"!==key||value!==!1&&value!==!0||(sortableWidgetInstance.floating=value),void(opts[key]=value)):(callbacks[key]?("stop"===key&&(value=combineCallbacks(value,function(){scope.$apply()}),value=combineCallbacks(value,afterStop)),value=combineCallbacks(callbacks[key],value)):wrappers[key]&&(value=wrappers[key](value)),opts[key]=value,void element.sortable("option",key,value))})},!0),angular.forEach(callbacks,function(value,key){opts[key]=combineCallbacks(value,opts[key]),"stop"===key&&(opts[key]=combineCallbacks(opts[key],afterStop))})):$log.info("ui.sortable: ngModel not provided!",element),void element.sortable(opts)):void $log.error("ui.sortable: jQuery should be included before AngularJS!")}}}]);
//# sourceMappingURL=maps/scripts.min.js.map
